#!/bin/env bash

start_pattern="#=AUTOGENERATED_COLORS="
end_pattern="#=AUTOGENERATED_COLORS_END="
config_dir="$HOME/.config/alacritty"
config_file="$config_dir/alacritty.yml"
theme_dir="$config_dir/themes"
theme_name="$1"
cache_file="$config_dir/.cache"
current_theme=$(cat $cache_file || "")

if [ "$theme_name" == "toggle" ]; then
  if [ "$current_theme" == "gruvbox_dark" ]; then
    theme_name="gruvbox_light"
  else
    theme_name="gruvbox_dark"
  fi
else
  if [ -z "$theme_name" ]; then
    echo "theme name is required"
    echo -e "\navailable themes:"
    ls $theme_dir | sed 's/.yml//' | sed 's/^/  - /'
    exit
  fi
fi

filepath="$theme_dir/$theme_name.yml"

content=$(cat <(cat "$config_file" | sed -z "s/$start_pattern.*//") <(printf "$start_pattern\n$(cat $filepath)\n$end_pattern" ""))
echo "$content" > "$config_file"
echo $theme_name > $cache_file